# P5-08: `walrus attach` Command

## Goal

Add an `attach` subcommand that connects an interactive REPL to a running
gateway, auto-discovering the gateway address from the workspace config.

## Depends On

P5-01 (workspace discovery), P4-06 (GatewayRunner and Runner trait).

## Design Decisions

- `walrus attach` discovers the nearest `walrus.toml` via
  `WorkspaceConfig::discover()`, reads `[gateway].bind` to build the
  WebSocket URL, and opens a REPL connected via GatewayRunner.
- `walrus attach --url ws://host:port` overrides auto-discovery with an
  explicit gateway URL.
- `walrus attach --agent <name>` selects a specific agent (defaults to
  the first agent in config or "default").
- Reuses ChatRepl from P4-05 with GatewayRunner from P4-06 — no new
  REPL logic needed.
- If no workspace is found and no `--url` provided, prints an error
  suggesting either `walrus init` or `--url`.

## Files

- **CREATE** `app/cli/src/cmd/attach.rs` — attach subcommand: discover
  workspace, build GatewayRunner, launch ChatRepl
- **MODIFY** `app/cli/src/cmd/mod.rs` — add mod attach
- **MODIFY** `app/cli/src/lib.rs` — add Attach variant to Command enum
- **MODIFY** `app/cli/src/bin/main.rs` — wire Attach subcommand

## Tests

- `attach_discovers_gateway_url` — reads bind address from workspace config
- `attach_explicit_url_overrides` — `--url` flag bypasses workspace discovery
- `attach_no_workspace_errors` — clear error when no walrus.toml found

## Done When

- [ ] `cargo check --workspace` and `cargo test --workspace` pass
- [ ] `walrus attach` connects to a running gateway from workspace dir
- [ ] `walrus attach --url ws://...` works without a workspace
