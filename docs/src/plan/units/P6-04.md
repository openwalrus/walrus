# P6-04: Hub Install and Remove

## Goal

Implement resource installation (fetch from source repo, place into
workspace) and removal, with lockfile tracking.

## Depends On

P6-02 (HubRegistry for manifest lookup and git operations).

## Design Decisions

- Reuses `Lockfile` struct from P6-01.
- `HubRegistry::install(name, workspace_root)` — finds manifest, clones
  the source repo to a temp dir via `git.rs`, checks out the specified
  ref, copies files from `source.path` to the target workspace directory
  based on resource_type. Updates lockfile.
- Install target mapping: skill→`skills/`, agent→`agents/`, mcp→`mcp/`,
  workspace→new sibling directory.
- `HubRegistry::remove(name, workspace_root)` — reads lockfile, deletes
  installed files, removes entry from lockfile.
- Refuses to install if a file with the same name exists in the target
  directory (workspace-tier protection). `--force` flag overrides.
- Temp dirs created and cleaned up via `tempfile` crate (workspace dep).

## Files

- **CREATE** `app/hub/src/install.rs` — install/remove logic, file copy
- **MODIFY** `app/hub/src/registry.rs` — add install and remove methods
- **MODIFY** `app/hub/src/lib.rs` — add mod install

## Tests

- `install_skill_to_workspace` — skill file copied to skills/ directory
- `install_updates_lockfile` — lockfile records the installation
- `install_refuses_existing_file` — conflict detection without --force
- `remove_deletes_files` — installed files removed
- `remove_updates_lockfile` — lockfile entry removed

## Done When

- [ ] `cargo check --workspace` and `cargo test --workspace` pass
- [ ] Resources install to correct workspace directories
- [ ] Lockfile tracks installed resources
- [ ] Remove cleans up files and lockfile
