# P2-04: Integrate Skills into Runtime

## Goal

Wire SkillRegistry into Runtime so that matched skills inject their bodies
into system prompts and auto-register their tools.

## Depends On

P2-01 (SkillRegistry).

## Design Decisions

- Runtime gains an optional `skills: Option<SkillRegistry>` field.
- Builder method: `Runtime::with_skills(registry) -> Self`.
- Before LLM call: match agent's `skill_tags` against the registry. For each
  matched skill, append the skill body to the system prompt and register
  the skill's `allowed_tools` if not already registered.
- Skill injection happens in `api_messages()` — same place memory is injected.
- Order: system_prompt, then memory context, then skill bodies.
- If no SkillRegistry is set, behavior is identical to before.
- `resolve()` supports glob prefixes in agent tool lists (DD#21). A name
  ending in `*` expands against all registered tool names by prefix match.
  Exact strings bypass glob logic. No-match globs log a warning.

## Files

- **MODIFY** `crates/runtime/src/lib.rs` — add skills field, with_skills(),
  update api_messages() to inject skill bodies

## Tests

- `runtime_without_skills_unchanged` — verify no change when skills is None
- `skill_body_injected` — verify matched skill body appears in system prompt
- `skill_tools_registered` — verify skill's allowed_tools available for dispatch
- `resolve_glob_prefix` — verify `"foo_*"` matches `"foo_a"` and `"foo_b"`
- `resolve_exact_unchanged` — verify exact strings still work

## Done When

- [ ] `cargo check --workspace` and `cargo test --workspace` pass
- [ ] Skill bodies appear in system prompt when tags match
