# P2-09: Simplify Runtime API

## Goal

Remove the `Chat` struct, make `send_to`/`stream_to` the primary API with
internal session management, and unify tool resolution into a single method.

## Depends On

P2-08 (Hook trait, compaction, ergonomic API).

## Design Decisions

- `Chat` eliminated. Sessions stored internally as private
  `Session { messages: Vec<Message>, compaction_count: usize }` keyed by agent
  name in a `BTreeMap`.
- `send_to(&mut self, agent, msg) -> Result<Response>` creates or reuses a
  session by agent name. Replaces the old `chat()` + `send()` two-step flow.
- `stream_to(&mut self, agent, msg) -> impl Stream` same pattern, streaming.
- `clear_session(&mut self, agent)` resets a session to empty.
- `resolve_tools(&self, names) -> Vec<(Tool, Handler)>` replaces both
  `resolve()` and `resolve_handlers()`. Glob-prefix logic written once.
- `resolve(&self, names) -> Vec<Tool>` becomes a thin wrapper calling
  `resolve_tools()` and discarding handlers.
- `resolve_handlers()` removed from public API.
- `build_team()` calls `resolve_tools()` directly.

## Files

- **MODIFY** `crates/runtime/src/lib.rs` — private Session struct, remove Chat,
  replace `chat()`/`send()`/`stream()` with `send_to()`/`stream_to()`,
  add `clear_session()`, add `resolve_tools()`, thin `resolve()` wrapper
- **DELETE** `crates/runtime/src/chat.rs`
- **MODIFY** `crates/runtime/src/team.rs` — use `resolve_tools()`
- **MODIFY** `crates/runtime/tests/runtime.rs` — update to new API
- **MODIFY** `crates/runtime/tests/team.rs` — update resolve usage

## Tests

- `send_to_creates_session`
- `send_to_reuses_session`
- `clear_session_resets`
- `resolve_tools_returns_both`
- `resolve_tools_glob`
- `resolve_returns_schemas_only`

## Done When

- [ ] `cargo check --workspace` and `cargo clippy --workspace` pass
- [ ] `cargo test --workspace` passes
- [ ] `Chat` struct and `chat.rs` no longer exist
- [ ] `resolve_handlers()` no longer public
