# P5-01: Workspace Config Schema and Types

## Goal

Define the Workspace concept: a project directory containing all walrus
configuration. Add types for workspace discovery and validation.

## Depends On

P3-08 (Gateway binary exists).

## Design Decisions

- A workspace is a directory with `walrus.toml` at the root (DD#24).
- Workspace layout: `agents/` (per-agent TOML files), `skills/` (skill
  directories with SKILL.md, agentskills.io format), `mcp/` (per-server TOML),
  `cron/` (per-job TOML), `data/` (runtime state, gitignored).
- `walrus.toml` contains gateway-level settings: `[gateway]` (bind, auth,
  logging), `[memory]` (backend, path). Agent/skill/mcp/cron configs
  are discovered from their directories.
- WorkspaceConfig struct in walrus-gateway: `root: PathBuf`, resolves
  all relative paths against the workspace root.
- `WorkspaceConfig::discover(path)` walks up from the given path to find
  the nearest `walrus.toml`, like Cargo.toml discovery.
- Single-file mode (`walrus.toml` with inline `[[agents]]`) still works.
  Workspace mode takes priority when directories exist.

## Files

- **CREATE** `app/gateway/src/workspace.rs` — WorkspaceConfig, discover(),
  per-directory loading helpers
- **MODIFY** `app/gateway/src/lib.rs` — add mod workspace, re-export types

## Tests

- `discover_workspace_root` — find walrus.toml walking up directories
- `workspace_loads_agent_files` — agents/ directory parsed into agent configs
- `workspace_loads_skill_files` — skills/ directory passed to SkillRegistry
- `workspace_loads_mcp_configs` — mcp/ directory parsed into McpServerConfig
- `single_file_mode_unchanged` — inline config still works

## Done When

- [ ] `cargo check --workspace` and `cargo test --workspace` pass
- [ ] WorkspaceConfig discovers and loads from directory structure
- [ ] Single-file GatewayConfig still works
