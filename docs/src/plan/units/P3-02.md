# P3-02: Walrus Protocol Crate

## Goal

Create the walrus-protocol crate with pure data types for the wire protocol
shared between Gateway and Client.

## Depends On

None.

## Design Decisions

- Lives in `app/protocol/`. Pure data types only — serde, no async, no I/O.
- ClientMessage enum: Authenticate (token field), SendMessage (content,
  agent_id), StreamMessage (content, agent_id). Tagged via `#[serde(tag)]`.
- ServerMessage enum: Authenticated (session_id), MessageResponse (content,
  agent_id), StreamChunk (delta, agent_id, done flag), Error (code,
  message). Tagged via `#[serde(tag)]`.
- Protocol version constant `PROTOCOL_VERSION: &str = "0.1"`.
- All types derive Serialize, Deserialize, Debug, Clone.
- String fields use `CompactString` for identity fields (agent_id,
  session_id), standard String for content/delta (unbounded length).

## Files

- **CREATE** `app/protocol/Cargo.toml` — depends on serde, serde_json,
  compact_str
- **CREATE** `app/protocol/src/lib.rs` — ClientMessage, ServerMessage,
  PROTOCOL_VERSION

## Tests

- `client_message_roundtrip` — serialize then deserialize each variant
- `server_message_roundtrip` — serialize then deserialize each variant
- `protocol_version_set` — verify PROTOCOL_VERSION is "0.1"

## Done When

- [ ] `cargo check --workspace` passes
- [ ] All message types serialize/deserialize correctly
- [ ] No async or I/O dependencies in the crate
