# P6-02: Hub Repo Management (Clone, Pull, Local Index)

## Goal

Implement hub repo cloning, pulling, and local manifest indexing. Manage
cached repos in `~/.walrus/hub/` via shell git commands (DD#35).

## Depends On

P6-01 (manifest types for parsing local TOML files).

## Design Decisions

- `HubSource` struct: name (`CompactString`), repo (String, `owner/repo`),
  local_path (`PathBuf`, computed as `~/.walrus/hub/<name>/`).
- `HubRegistry` struct: sources (`Vec<HubSource>`), cache_dir (`PathBuf`).
  Main entry point for all hub operations.
- `HubRegistry::default_source()` returns `walrus-hub/hub`.
- `HubRegistry::sync(source)` — if local path absent, runs
  `git clone --depth 1 https://github.com/<repo>.git <local_path>`.
  If present, runs `git -C <local_path> pull --ff-only`.
- `HubRegistry::sync_all()` — syncs all configured sources.
- `HubRegistry::list_manifests(resource_type)` — walks local cache dirs
  (`skills/`, `agents/`, `mcp/`, `workspaces/`), parses all `.toml` files,
  optionally filters by ResourceType.
- `HubRegistry::find_manifest(name)` — searches all sources for a manifest
  by name field, returns first match with its source.
- Git wrapper module (`git.rs`): `clone(url, path, depth)`,
  `pull(path)`, `checkout(path, ref_)`. All shell out to `git` via
  `std::process::Command`. Returns `Result` with stderr on failure.
- `HubConfig` struct for `~/.walrus/config.toml`: `[[hub.sources]]` array.

## Files

- **CREATE** `app/hub/src/git.rs` — shell-git wrapper functions
- **CREATE** `app/hub/src/registry.rs` — HubRegistry, HubSource, sync
- **CREATE** `app/hub/src/config.rs` — HubConfig, source loading
- **MODIFY** `app/hub/src/lib.rs` — add mod git, registry, config

## Tests

- `git_clone_command_args` — verify constructed git clone command is correct
- `list_manifests_returns_all` — walking a test dir returns all manifests
- `list_manifests_filters_by_type` — type filter works
- `find_manifest_by_name` — name lookup across sources
- `hub_config_from_toml` — HubConfig parses from TOML

## Done When

- [ ] `cargo check --workspace` and `cargo test --workspace` pass
- [ ] HubRegistry can sync repos via shell git
- [ ] Local manifest index is searchable
