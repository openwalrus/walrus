# P6-01: Hub Manifest Types and Parsing

## Goal

Define the hub manifest TOML schema as Rust types in a new `walrus-hub`
crate with parsing and validation.

## Depends On

P5-01 (workspace layout established, directory conventions defined).

## Design Decisions

- `walrus-hub` lives at `app/hub`. Application-level crate defining hub
  metadata structure. Depends on serde, toml, compact_str from workspace.
  No dependency on walrus-core or walrus-runtime. `app/cli` imports types
  from `app/hub` for git-based operations.
- `Manifest` struct: name (`CompactString`), description (String), version
  (String), resource_type (`ResourceType`), author (String), tags
  (`Vec<CompactString>`), source (`Source`).
- `ResourceType` enum: Skill, Agent, Mcp, Workspace. Serde-renamed to
  lowercase strings.
- `Source` struct: github (String, `owner/repo`), path (`Option<String>`,
  file or dir within repo), ref_ (`Option<String>`, git tag/branch/sha).
- `Manifest::from_file(path)` reads and parses a TOML manifest file.
- `Manifest::validate()` checks name non-empty, resource_type valid, and
  source.github matches `owner/repo` format.
- `Source.ref_` uses `#[serde(rename = "ref")]` to match TOML field name.
- `Lockfile` struct also defined here (shared by P6-03 info and P6-04
  install): `[[resources]]` array with name, version, source_name,
  source_repo, resolved_ref, resource_type, installed_files.
- `find_workspace_root(path)` — walks up directories looking for
  `walrus.toml`. Standalone function, no gateway dependency. Reused by
  P5-08, P6-04, P6-06.
- Error type: `HubError` enum with variants for parse, git, io, validation.

## Files

- **CREATE** `app/hub/Cargo.toml` — new crate; workspace deps: serde, toml,
  compact_str, tempfile, dirs, anyhow
- **CREATE** `app/hub/src/lib.rs` — crate root, mod declarations, HubError
- **CREATE** `app/hub/src/manifest.rs` — Manifest, ResourceType, Source
- **CREATE** `app/hub/src/lockfile.rs` — Lockfile struct, load, save
- **MODIFY** `Cargo.toml` — add app/hub to workspace members; add hub,
  tempfile, dirs to `[workspace.dependencies]`

## Tests

- `parse_skill_manifest` — valid skill manifest TOML parses correctly
- `parse_workspace_manifest` — workspace type with GitHub source parses
- `validate_rejects_empty_name` — validation catches empty name
- `resource_type_serde_lowercase` — serializes/deserializes as lowercase
- `lockfile_roundtrip` — serialize/deserialize lockfile TOML
- `find_workspace_root_walks_up` — finds walrus.toml in parent dirs

## Done When

- [ ] `cargo check --workspace` and `cargo test --workspace` pass
- [ ] Manifest and ResourceType re-exported from walrus-hub
- [ ] TOML manifests parse into typed Rust structs
