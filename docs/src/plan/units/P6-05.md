# P6-05: Hub Update and Lockfile Management

## Goal

Implement the update workflow: refresh hub repo indices, detect outdated
installed resources, and re-install updated versions. Add source management.

## Depends On

P6-04 (install logic and lockfile).

## Design Decisions

- `walrus hub update` performs: (1) `sync_all()` pulls latest manifests,
  (2) compares installed resources against current manifests.
- `HubRegistry::check_updates(lockfile)` — for each lockfile entry, finds
  current manifest, compares version strings. Returns `Vec<UpdateInfo>`
  where `UpdateInfo` has name, installed_version, available_version.
- `HubRegistry::upgrade(name, workspace_root)` — removes old files,
  re-installs from current manifest. Lockfile updated only on success.
- `HubRegistry::upgrade_all(workspace_root)` — upgrades all outdated.
  Returns names of upgraded resources.
- `add_source(name, repo)` appends to `~/.walrus/config.toml`
  `[[hub.sources]]`, then syncs the new source.
- `remove_source(name)` removes from config and deletes the local cache.

## Files

- **CREATE** `app/hub/src/update.rs` — UpdateInfo, check_updates, upgrade
- **CREATE** `app/hub/src/source.rs` — add_source, remove_source
- **MODIFY** `app/hub/src/registry.rs` — add update and source methods
- **MODIFY** `app/hub/src/lib.rs` — add mod update, mod source

## Tests

- `check_updates_detects_version_change` — new version flagged
- `check_updates_no_change` — same version returns empty
- `upgrade_replaces_files` — old removed, new installed
- `add_source_persists` — new source in config file
- `remove_source_cleans_up` — source removed from config and cache

## Done When

- [ ] `cargo check --workspace` and `cargo test --workspace` pass
- [ ] Update refreshes index and reports available updates
- [ ] Upgrade replaces files cleanly
- [ ] Source management persists to config
