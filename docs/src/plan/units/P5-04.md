# P5-04: OpenAPI Schema Derives on Protocol Types

## Goal

Add utoipa `ToSchema` derives to walrus-protocol types so they can be
referenced in OpenAPI spec generation.

## Depends On

P3-02 (protocol crate exists).

## Design Decisions

- Add utoipa as an optional dependency behind an `openapi` feature flag
  in walrus-protocol. `utoipa = { workspace = true, optional = true }`.
- `ToSchema` derives added to: ClientMessage variants' inner types,
  ServerMessage variants' inner types, and shared field types.
- New REST-specific request types in walrus-protocol: `SendRequest`
  (content, agent_id) and `StreamRequest` (content, agent_id). These
  mirror ClientMessage::SendMessage/StreamMessage but without the enum
  wrapping, for cleaner REST API ergonomics.
- REST-specific response types: `AgentInfo` (name, description, tools,
  skill_tags) and `HealthResponse` (status, version).
- All new types derive Serialize, Deserialize, Debug, Clone, `ToSchema`.
- Feature flag avoids pulling utoipa into consumers that don't need it.

## Files

- **MODIFY** `Cargo.toml` — add utoipa, utoipa-axum, utoipa-swagger-ui to
  `[workspace.dependencies]`
- **MODIFY** `app/protocol/Cargo.toml` — add utoipa optional dep, openapi feature
- **MODIFY** `app/protocol/src/lib.rs` — add ToSchema derives (behind cfg),
  add SendRequest, StreamRequest, AgentInfo, HealthResponse types

## Tests

- `send_request_roundtrip` — serialize/deserialize SendRequest
- `agent_info_roundtrip` — serialize/deserialize AgentInfo
- `health_response_roundtrip` — serialize/deserialize HealthResponse

## Done When

- [ ] `cargo check --workspace` and `cargo test --workspace` pass
- [ ] `cargo check -p walrus-protocol --features openapi` passes
- [ ] All new types serialize/deserialize correctly
