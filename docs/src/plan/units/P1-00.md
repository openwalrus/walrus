# P1-00: Migrate Core Types to Performance Primitives

## Goal

Replace `String` with `CompactString` for identity fields, `Vec` with `SmallVec`
for bounded collections, and add `bytes` to workspace. Establishes the
performance foundation before new Phase 1 types are added.

## Depends On

None.

## Design Decisions

- `CompactString` for fields that are short identity strings (names, IDs, roles).
  Stores up to 24 bytes inline without heap allocation.
- `SmallVec<[T; N]>` for collections with a known small upper bound. N chosen
  per field: tool lists (8), tool calls (4), attachments (4).
- `String` stays for content fields (message content, system prompts, reasoning)
  — these are unbounded and benefit from heap allocation.
- `bytes` added to workspace deps for future streaming/WebSocket use.
- All public APIs continue to accept `impl Into<CompactString>` or
  `impl Into<String>` — callers can still pass `&str`.

## Files

- **MODIFY** `Cargo.toml` (workspace root) — add compact_str, smallvec, bytes
- **MODIFY** `crates/llm/Cargo.toml` — add compact_str, smallvec deps
- **MODIFY** `crates/llm/src/tool.rs` — name, description, id, call_type, arguments to `CompactString`
- **MODIFY** `crates/llm/src/config.rs` — model to `CompactString`
- **MODIFY** `crates/llm/src/message.rs` — tool_call_id to `CompactString`; tool_calls to `SmallVec<[ToolCall; 4]>`
- **MODIFY** `crates/llm/src/response.rs` — id, object, model to `CompactString`
- **MODIFY** `crates/core/Cargo.toml` — add compact_str, smallvec deps
- **MODIFY** `crates/core/src/agent.rs` — name, description to `CompactString`; tools to `SmallVec<[CompactString; 8]>`
- **MODIFY** `crates/core/src/chat.rs` — agent_name to `CompactString`
- **MODIFY** `crates/runtime/Cargo.toml` — add compact_str, smallvec deps
- **MODIFY** `crates/runtime/src/lib.rs` — update tool registry key type if needed

## Tests

- `compact_string_identity` — verify Agent name round-trips through `CompactString`
- `smallvec_tools` — verify Agent tool list works with SmallVec
- `existing_tests_pass` — all existing tests pass without changes

## Done When

- [ ] `cargo check --workspace` passes
- [ ] `cargo test --workspace` passes
- [ ] `cargo clippy --workspace` passes
- [ ] No `String` used for identity fields in walrus-llm or walrus-core
