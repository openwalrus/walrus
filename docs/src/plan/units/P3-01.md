# P3-01: Create walrus-gateway App Skeleton

## Goal

Create the walrus-gateway application crate with a `Gateway` struct that
holds a Runtime and loads configuration from TOML.

## Depends On

Phase 2 (Runtime with memory, skills, MCP).

## Design Decisions

- Gateway lives in `app/gateway/` with binary entry point at `src/bin/main.rs`.
- `Gateway<M: Memory>` holds: `runtime: Runtime<M>`, `config: GatewayConfig`.
- GatewayConfig loaded from TOML via serde. Sections: `[gateway]` (bind
  address), `[[agents]]`, `[[mcp_servers]]`, `[skills]` (directory path),
  `[memory]` (backend, path), `[[cron_jobs]]`, `[auth]` (keys), `[logging]`.
- MemoryConfig: `backend` enum (inmemory / sqlite), optional `path` (for
  sqlite db file). Defaults to inmemory.
- SkillsConfig: `directory` path for skill files.
- MCP server config: `mcp_servers: Vec<McpServerConfig>`. McpServerConfig
  fields: name (`CompactString`), command (String), args (`Vec<String>`),
  env (`BTreeMap<String, String>`), auto_restart (bool, default true).
  Gateway spawns these on boot, passes peers to McpBridge (DD#20).
- Gateway exposes `new(config, runtime) -> Self` constructor.
- Config file path from CLI arg or `WALRUS_CONFIG` env var, default
  `walrus.toml`.
- Binary entry point is a stub in this unit — just loads config and
  constructs Gateway. Full wiring in P3-08.

## Files

- **MODIFY** `app/gateway/Cargo.toml` — depends on walrus-runtime, walrus-core,
  walrus-sqlite, serde, toml, tokio, anyhow; add `[[bin]]` section
- **MODIFY** `app/gateway/src/lib.rs` — Gateway struct, GatewayConfig (with
  MemoryConfig, SkillsConfig, McpServerConfig), config loading
- **CREATE** `app/gateway/src/bin/main.rs` — binary stub (load config, construct
  Gateway)

## Tests

- `gateway_config_from_toml` — verify TOML string parses into GatewayConfig
- `gateway_config_mcp_servers` — verify `[[mcp_servers]]` section parses
- `gateway_config_memory_sqlite` — verify `[memory]` with backend = "sqlite" parses
- `gateway_config_skills_dir` — verify `[skills]` directory path parses
- `gateway_construction` — verify Gateway builds with config and Runtime

## Done When

- [ ] `cargo check --workspace` passes
- [ ] Gateway struct compiles with generic Memory parameter
- [ ] Config loads from TOML string with all sections
