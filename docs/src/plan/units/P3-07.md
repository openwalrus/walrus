# P3-07: Cron Scheduler

## Goal

Implement a scheduler that runs agent tasks on cron schedules, each in
an isolated session.

## Depends On

P3-01 (Gateway — accesses Runtime for job execution).

## Design Decisions

- `CronScheduler<M: Memory>` holds a list of CronJob values loaded from
  GatewayConfig and a reference to `Runtime<M>`.
- CronJob: agent_id (`CompactString`), schedule (cron expression string),
  message_template (String), parsed schedule (`cron::Schedule`).
- `CronScheduler::start()` spawns a tokio task with a timer loop. Each
  tick (1-second resolution) checks all jobs against current time.
- Per DD#6: each triggered job creates a fresh Session with SessionScope::Cron
  and a new UUID. No state carried between runs. Config-only, no persistence.
- Job execution: create Session, call `runtime.send()` with the message
  template, log the result. Errors logged but do not stop the scheduler.
- Uses the `cron` crate for expression parsing (standard 6-field format).
- Graceful shutdown: scheduler task listens on a broadcast channel and
  exits the loop when signaled.

## Files

- **CREATE** `app/gateway/src/cron.rs` — `CronScheduler<M>`, CronJob, timer loop
- **MODIFY** `app/gateway/src/lib.rs` — add mod cron, re-export types
- **MODIFY** `app/gateway/Cargo.toml` — add cron dependency

## Tests

- `cron_job_parse_schedule` — verify valid cron expression parses
- `cron_job_invalid_schedule` — verify invalid expression returns error
- `cron_scheduler_construction` — verify scheduler builds from config

## Done When

- [ ] `cargo check --workspace` and `cargo test --workspace` pass
- [ ] Cron expressions parse correctly
- [ ] Each job runs in isolated session with Cron scope
