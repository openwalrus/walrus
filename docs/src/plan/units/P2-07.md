# P2-07: Team Delegation (worker agents call LLM)

## Goal

Make `build_team` register real worker handlers that run self-contained LLM
send loops instead of returning stub strings.

## Depends On

P2-03 (memory integration), P2-04 (skills integration).

## Design Decisions

- Standalone worker runner pattern: each worker handler captures Provider
  (Clone), `General` config (Clone), `Arc<M>` memory, Agent (Clone), resolved
  `Vec<Tool>`, and resolved `BTreeMap<CompactString, Handler>`.
- Worker executes a self-contained send loop (up to `MAX_TOOL_CALLS` rounds)
  entirely within the closure, without referencing the Runtime.
- `build_team` is generic: `build_team<M: Memory + 'static>`.
- Worker agents are registered in the runtime via `add_agent`.
- `worker_send` is a private async helper handling the LLM send loop,
  system prompt enrichment with memory, and tool dispatch.
- Runtime gains accessor methods: `provider()`, `config()`, `memory_arc()`,
  `resolve_handlers()`. The last supports glob prefixes like `resolve()`.

## Files

- **MODIFY** `crates/runtime/src/lib.rs` — add accessor methods
- **MODIFY** `crates/runtime/src/team.rs` — rewrite `build_team`, add `worker_send`
- **MODIFY** `crates/runtime/tests/team.rs` — add team delegation tests

## Tests

- `build_team_registers_workers_as_tools` — workers appear as resolvable tools
- `build_team_adds_worker_agents` — worker agents registered in runtime
- `worker_handler_parses_input` — handler returns error on invalid JSON
- `build_team_worker_tool_descriptions` — tool carries worker description

## Done When

- [x] `cargo check --workspace` and `cargo test --workspace` pass
- [x] `build_team` registers real handlers (not stubs)
- [x] Worker agents registered in runtime after `build_team`
- [x] `worker_send` runs self-contained LLM loop with tool dispatch
