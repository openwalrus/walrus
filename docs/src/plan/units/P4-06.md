# P4-06: CLI Gateway Mode (Connect via walrus-client)

## Goal

Implement GatewayRunner and a Runner trait that unifies DirectRunner and
GatewayRunner behind a common interface.

## Depends On

P4-02, P4-05.

## Design Decisions

- Runner trait with `send()` and `stream()` methods. Both DirectRunner and
  GatewayRunner implement it.
- GatewayRunner wraps a `walrus_client::Connection`.
- GatewayRunner translates between Runtime types (Message, Response,
  StreamChunk) and Protocol types (ClientMessage, ServerMessage).
- `--gateway ws://...` flag triggers GatewayRunner construction.
- ChatRepl becomes generic over Runner.
- Runner trait uses RPITIT async methods (DD#11). No dyn dispatch.

## Files

- **CREATE** `app/cli/src/runner.rs` — Runner trait
- **CREATE** `app/cli/src/gateway.rs` — GatewayRunner struct
- **MODIFY** `app/cli/src/direct.rs` — implement Runner for DirectRunner
- **MODIFY** `app/cli/src/repl.rs` — make ChatRepl generic over Runner
- **MODIFY** `app/cli/Cargo.toml` — add walrus-client dep
- **MODIFY** `app/cli/src/lib.rs` — add mod runner, mod gateway

## Tests

- `runner_trait_bounds` — verify Runner trait compiles with Send + Sync
- `gateway_runner_construction` — verify GatewayRunner::new compiles

## Done When

- [ ] `cargo check --workspace` passes
- [ ] `walrus --gateway ws://... chat` compiles and dispatches to GatewayRunner
- [ ] ChatRepl works with both DirectRunner and GatewayRunner
