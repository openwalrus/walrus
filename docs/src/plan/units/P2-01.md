# P2-01: Add SkillRegistry to walrus-runtime

## Goal

Create a SkillRegistry that loads Skill definitions from a directory of
TOML-frontmatter files, indexes them by tag and trigger keyword, and
ranks matches by tier and priority.

## Depends On

Phase 1 (P1-04 — Skill struct and SkillTier).

## Design Decisions

- SkillRegistry lives in walrus-runtime, not walrus-core. Core defines the
  data types; runtime owns the loading and matching logic.
- Skill files use TOML frontmatter delimited by `+++` lines, followed by
  the skill body (Markdown). Parsed with the `toml` crate.
- `SkillRegistry::load_dir(path: impl AsRef<Path>, tier: SkillTier)` scans
  a directory for `.md` files, parses each, assigns the given tier, and
  builds tag/trigger indices. Returns `Result<Self>`.
- Tag index: `BTreeMap<CompactString, Vec<usize>>` mapping tag to skill indices.
- Trigger index: `BTreeMap<CompactString, Vec<usize>>` mapping keyword to indices.
- `find_by_tags` returns skills sorted by SkillTier (desc) then priority (desc).
- `find_by_trigger` does case-insensitive keyword match (DD#4).

## Files

- **CREATE** `crates/runtime/src/skills.rs` — SkillRegistry, parsing, indexing, load_dir
- **MODIFY** `crates/runtime/src/lib.rs` — add mod skills, re-export SkillRegistry
- **MODIFY** `crates/runtime/Cargo.toml` — add toml dependency

## Tests

- `parse_skill_frontmatter` — verify TOML frontmatter parsed into Skill struct
- `load_dir_discovers_files` — verify directory scanning finds all .md files
- `find_by_tags_returns_matches` — verify tag lookup returns correct skills
- `find_by_trigger_case_insensitive` — verify keyword match is case-insensitive
- `ranking_by_tier_then_priority` — verify Workspace > Managed > Bundled ordering

## Done When

- [ ] `cargo check --workspace` and `cargo test --workspace` pass
- [ ] SkillRegistry re-exported from walrus-runtime
- [ ] `load_dir()` discovers and parses skill files from a directory
