# P2-01: Add SkillRegistry to walrus-runtime

## Goal

Create a SkillRegistry that loads Skill definitions from skill directories
(SKILL.md with YAML frontmatter), indexes them by tag and trigger keyword,
and ranks matches by tier and priority.

## Depends On

Phase 1 (P1-04 — Skill struct and SkillTier).

## Design Decisions

- SkillRegistry lives in walrus-runtime, not walrus-core. Core defines the
  data types; runtime owns the loading and matching logic.
- Skill files follow the agentskills.io specification: YAML frontmatter
  delimited by `---` lines, followed by a Markdown body. Each skill is a
  directory containing a `SKILL.md` file. Parsed with the `serde_yaml` crate.
- `SkillRegistry::load_dir(path: impl AsRef<Path>, tier: SkillTier)` scans
  a directory for skill subdirectories (each containing `SKILL.md`), parses
  each, assigns the given tier, and builds tag/trigger indices from metadata.
  Returns `Result<Self>`.
- Tag index: `BTreeMap<CompactString, Vec<usize>>` mapping tag to skill indices.
  Tags come from `metadata["tags"]`.
- Trigger index: `BTreeMap<CompactString, Vec<usize>>` mapping keyword to indices.
  Triggers come from `metadata["triggers"]`.
- `find_by_tags` returns skills sorted by SkillTier (desc) then priority (desc).
  Priority comes from `metadata["priority"]` (defaults to 0).
- `find_by_trigger` does case-insensitive keyword match (DD#4).

## Files

- **CREATE** `crates/runtime/src/skills.rs` — SkillRegistry, parsing, indexing, load_dir
- **MODIFY** `crates/runtime/src/lib.rs` — add mod skills, re-export SkillRegistry
- **MODIFY** `crates/runtime/Cargo.toml` — add serde_yaml dependency

## Tests

- `parse_skill_frontmatter` — verify YAML frontmatter parsed into Skill struct
- `load_dir_discovers_skills` — verify directory scanning finds all SKILL.md files
- `find_by_tags_returns_matches` — verify tag lookup returns correct skills
- `find_by_trigger_case_insensitive` — verify keyword match is case-insensitive
- `ranking_by_tier_then_priority` — verify Workspace > Managed > Bundled ordering

## Done When

- [x] `cargo check --workspace` and `cargo test --workspace` pass
- [x] SkillRegistry re-exported from walrus-runtime
- [x] `load_dir()` discovers and parses skill files from a directory
