# P3-06: Channel Routing

## Goal

Implement a routing table that maps incoming channel events to the correct
agent based on platform and channel ID.

## Depends On

P3-03 (Session — routing creates sessions for matched agents).

## Design Decisions

- ChannelRouter struct holds an ordered list of RoutingRule values.
- RoutingRule: match criteria (platform: `Option<Platform>`, channel_id:
  `Option<CompactString>`) and target agent_id (`CompactString`).
- Resolution order per DD#3: exact match (platform + channel_id) first,
  then platform catch-all (platform only), then default agent fallback.
- Default agent configured in GatewayConfig. Error if no default and no
  match found.
- `ChannelRouter::resolve(platform, channel_id) -> Result<CompactString>`
  returns the matched agent_id.
- Rules loaded from GatewayConfig TOML at startup. No runtime rule changes.

## Files

- **CREATE** `app/gateway/src/router.rs` — ChannelRouter, RoutingRule,
  resolve logic
- **MODIFY** `app/gateway/src/lib.rs` — add mod router, re-export types

## Tests

- `route_exact_match` — platform + channel_id matches specific rule
- `route_platform_catchall` — platform-only rule matches when no exact match
- `route_default_fallback` — default agent used when no rules match
- `route_no_match_no_default` — error when no rules and no default

## Done When

- [ ] `cargo check --workspace` and `cargo test --workspace` pass
- [ ] Three-tier fallback chain works correctly
- [ ] Rules loaded from config
